services:
  alex:
    # Option 1: Use pre-built image from Docker Hub (recommended)
    image: jamesacklin/alex:latest

    # Option 2: Build from source (comment out 'image' above and uncomment below)
    # build: .

    ports:
      - "${PORT:-3000}:3000"

    environment:
      # Paths inside the container â€“ these should not normally need changing
      DATABASE_PATH: /app/data/library.db
      LIBRARY_PATH: /app/data/library

      # Set NEXTAUTH_SECRET in a .env file at the project root (required)
      NEXTAUTH_SECRET: ${NEXTAUTH_SECRET:?Create a .env file and set NEXTAUTH_SECRET}
      NEXTAUTH_URL: ${NEXTAUTH_URL:-http://localhost:3000}

      # ---- S3 / R2 mode (optional) ----
      # Uncomment these to use an S3-compatible bucket instead of a local folder.
      # When S3_BUCKET is set, the local library volume mount is not needed.
      # S3_ENDPOINT: ${S3_ENDPOINT:-}
      # S3_REGION: ${S3_REGION:-auto}
      # S3_BUCKET: ${S3_BUCKET:-}
      # S3_ACCESS_KEY_ID: ${S3_ACCESS_KEY_ID:-}
      # S3_SECRET_ACCESS_KEY: ${S3_SECRET_ACCESS_KEY:-}
      # S3_PREFIX: ${S3_PREFIX:-}
      # S3_POLL_INTERVAL: ${S3_POLL_INTERVAL:-60}

    volumes:
      # Persistent storage for the SQLite database and generated cover images.
      # Lives in a Docker-managed named volume so it survives container restarts
      # and image rebuilds without touching your local filesystem.
      - alex-data:/app/data

      # Your local PDF/EPUB collection, mounted into the container's library
      # directory.  Change the left-hand path to point to wherever your books
      # live on disk, for example:
      #
      #   /Volumes/books:/app/data/library
      #   /home/user/My Books:/app/data/library
      #   ~/Documents/eBooks:/app/data/library
      #
      # The default (./library) creates a "library" folder next to your
      # docker-compose.yml if it doesn't already exist.
      - /Volumes/books:/app/data/library

    restart: unless-stopped

volumes:
  alex-data:
